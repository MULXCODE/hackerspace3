<h2>Scorecards for <%= @project.team_name %> - <%= @project.project_name %> <%= '(with Judges)' if params[:include_judges] == 'true' %></h2>

  <table>
  	<thead>
      <th>Status</th>
      <th>Action</th>
      <% @project_criteria.each do |criterion| %>
        <th><%= criterion.name %></th>
      <% end %>
      <th>Score</th>
      <th>Average Score</th>
      <th>Scorecard Count</th>
  	</thead>
  	<tbody>
      <% @scorecards.each do |scorecard| %>
        <tr>
          <% scores = scorecard.judgments.pluck(:score) %>
          <% if scores.include? nil %>
            <td>Incomplete</td>
            <td><%= link_to 'Delete Scorecard', admin_team_scorecard_path(@team, scorecard, include_judges: params[:include_judges]), data: { confirm: "Are you sure?" }, method: :delete %></td>
          <% elsif scorecard.included %>
            <td>Included</td>
            <td><%= link_to 'Exclude Scorecard', admin_team_scorecard_path(@team, scorecard, include_judges: params[:include_judges]), method: :patch %></td>
          <% else %>
            <td>Excluded</td>
            <td><%= link_to 'Include Scorecard', admin_team_scorecard_path(@team, scorecard, include_judges: params[:include_judges]), method: :patch %></td>
          <% end %>
          <% scores.each do |score| %>
            <td><%= score %></td>
          <% end %>
          <% mean_score = ((scores.mean / MAX_SCORE.to_f) * 100).to_i %>
					<%= render 'challenges/judging_cell', locals: { total: mean_score } %>
          <% all_scores_mean = scorecard.assignment_judgments.pluck(:score).mean %>
          <% mean_score = ((all_scores_mean / MAX_SCORE.to_f) * 100).to_i %>
					<%= render 'challenges/judging_cell', locals: { total: mean_score } %>
          <td><%= scorecard.assignment_scorecards.length %></td>
        </tr>
      <% end %>
  	</tbody>
  </table>

<%= link_to 'Close', root_path, id: 'close-team-scorecards' %>
<%= javascript_tag 'window.addEventListener("unload", function(event) { window.opener.location.reload();})' %>
