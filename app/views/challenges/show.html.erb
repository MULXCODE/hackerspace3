<main class="challenge_page">
<section class="challenge_head">
<article>
<h2><%= @challenge.name %></h2>

<h3>Jurisdiction: <%= @region.name %></h3>
</article>

<aside class="sponsors">
	<% if @challenge_sponsorships.present? %>
  <% @challenge_sponsorships.each do |sponsorship| %>
 	<% sponsor = sponsorship.sponsor %>
	  <figure>
			<a href='<%= sponsor.website %>' target="_blank">
	      <% if sponsor.logo.attached? %>
	        <%= image_tag url_for(sponsor.logo) %>
	      <% else %>
	        <%= image_tag 'default_profile_pic.png' %>
	      <% end %>
			</a>
	  </figure>

  <% end %>
<% end %>
</aside>
</section>
<section class="challenge_body">
	<article>
		<% unless @challenge.short_desc.blank? %>
		  <h4><%= @challenge.short_desc %></h4>
		<% end %>
		<% unless @challenge.long_desc.blank? %>
		  <p><%= simple_format(@challenge.long_desc) %></p>
		<% end %>
		<% unless @challenge.eligibility.blank? %>
		  <p><strong>Eligibility</strong>: <%= @challenge.eligibility %></p>
		<% end %>

		<% if @data_sets.present? %>

		<h5>Dataset Highlight</h5>

		  <% @data_sets.each do |data_set| %>
		 	<p><strong><%= data_set.name %></strong><br />
		 	<%= link_to(data_set.url,data_set.url) %></p>

		  <% end %>
		<% end %>

	</article>
	<aside>
		<% unless @challenge.video_url.blank? %>
			<div class="videoWrapper"><iframe width="560" height="315" src="<%= @challenge.video_url %>" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>
		<% end %>
		<% if @challenge.pdf.attached? && @challenge.pdf_preview.attached? %>
		  <a href='<%= url_for(@challenge.pdf) %>' target="_blank">
		    <img class="pdf_preview" src="<%= url_for(@challenge.pdf_preview) %>" alt="<%= @challenge.name %> pdf_preview" title="Govhack Hackerspace" /><br>
		  </a>
		<% end %>
	</aside>
</section>

<% if @challenge.image.attached? %>
  <img src="<%= url_for(@challenge.image) %>" alt="<%= @challenge.name %> image" /><br>
<% end %>

</section>
<h3>Team Entries</h3>

<%= pluralize @challenge.entries.count, 'team' %> have entered into this challenge.<br>

<% if user_signed_in? %>
	<% unless @user_eligible_teams.empty? %>
		<h4>Your Team Entries</h4>
	  <% @user_eligible_teams.each do |team| %>
	    <h5><%= team.name %></h4>
	    <% if (entry = Entry.find_by(team: team, challenge: @challenge)).present? %>
	      Team entered into this challenge for <%= entry.checkpoint.name %> Checkpoint.<br>
	    <% else %>
	      <% if team.available_checkpoints(@challenge).present? %>
	        <%= link_to 'Enter Challenge', new_team_management_team_entry_path(team, challenge_id: @challenge.id) %><br>
	      <% else %>
					<% if team.all_checkpoints_passed? %>
	        	All Checkpoints have passed.<br>
					<% else %>
						All avaiable checkpoint limits reached for
						<%= @region.national? ? 'national' : 'regional' %> challenges.<br>
					<% end %>
	      <% end %>
	    <% end %>
	  <% end %>
	<% end %>
<% else %>
  Sign in to enter your team into this challenge.<br>
<% end %>

<% passed_competition_checkpoints.each do |checkpoint| %>

  <% if (teams = challenge_teams(checkpoint)).present? %>

    <h3><%= checkpoint.name %> Checkpoint</h3>

    <% teams.each do |team| %>
      <h4><%= team.name %></h4>
      <%= link_to 'Go to Team', team_path(team) %><br>
    <% end %>

  <% end %>

<% end %>


<%= link_to 'Back to Challenges', challenges_path %>
</main>
