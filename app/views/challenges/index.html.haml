- content_for :title, 'Challenges'
%main.challenge_index
  %h2 Challenges for Competition #{@competition.year}
  = form_tag challenges_path, method: :get do
    = search_field_tag :term, params[:term]
    = submit_tag 'Search'
  %p= link_to 'Clear Search', challenges_path
  %p= link_to 'Download CSV', challenges_path(format: 'csv'), class: 'download-csv'
  - @regions.each do |region|
    - next unless @competition.started?(region.time_zone) || region.international?
    - next if (challenges = @region_challenges[region.id]).empty?
    %h3= region.name
    - challenges.each do |challenge|
      %section.challenge
        %article
          %h4= challenge.name
          - unless challenge.short_desc.blank?
            %h5= challenge.short_desc
          %p
            = link_to 'Go to Challenge', challenge_path(challenge.identifier)
            - count = @counter.count(challenge)
            | #{pluralize count, 'team has', plural: 'teams have' }
            entered this challenge across all checkpoints that have passed.
        %aside.sponsors
          - if challenge.challenge_sponsorships.present?
            - challenge.challenge_sponsorships.each do |sponsorship|
              %figure
                - sponsor = sponsorship.sponsor
                = link_to (image_tag(sponsor.logo.attached? ? url_for(sponsor.logo) : 'default_profile_pic.png')), sponsor.website, target: '_blank'
