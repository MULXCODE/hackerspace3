<main class="challenge_index">

<h2>Challenges for Competition <%= @competition.year %></h2>

<% if @competition.started? || (user_signed_in? && current_user.region_privileges?) %>

  <%= form_tag challenges_path, method: :get do %>
    <%= text_field_tag :term, params[:term] %>
    <%= submit_tag 'Search' %>
  <% end %>
  <%= link_to 'Clear Search', challenges_path %></br>
  <%= link_to 'Download CSV', challenges_path(format: 'csv') %></br>

  <% @regions.each do |region| %>
    <% next if (challenges = @region_challenges[region.id]).empty? %>
    <h3><%= region.name %></h3>
    <% challenges.each do |challenge| %>
      <h4><%= challenge.name %></h4>
      <% unless challenge.short_desc.blank? %>
        Short Description: <%= challenge.short_desc %><br>
      <% end %>
      <%= pluralize @challenge_id_to_entry_count[challenge.id], 'team' %> have entered this challenge.<br>
      <%= link_to 'Go to Challange', challenge_path(challenge) %>
    <% end %>
  <% end %>

<% else %>
<section class="later">
  <p><strong>Check back here at the commencement of the competition at <%= @competition.start_time.strftime("%I.%M %p %e %B %Y") %></strong></p>
</section>
<% end %>