<main class="team_page">
<h2><%= @current_project.project_name %></h2>

<aside>
  <% if user_signed_in? %>
    <% if @user.in_team?(@team) && @competition.in_competition_window?(@team.time_zone) %>
      <p><%= link_to 'Manage this Team Project', team_management_team_path(@team) %></p>
    <% end %>
    <% if @favourite.present? %>
      <p><%= link_to 'Unfavourite this Project', favourite_path(@favourite),
                    method: :delete %></p>
    <% else %>
      <p><%= link_to 'Favourite this Project', favourites_path(team_id: @team.id), method: :post %></p>
    <% end %>
    <% if @competition.in_judging_window? %>
      <% if @scorecard.present? %>
        <%= link_to 'Edit Scorecard', edit_project_scorecard_path(@current_project.identifier, @scorecard) %></br>
      <% elsif @judgeable_assignment.present? %>
        <%= link_to 'New Scorecard', new_project_scorecard_path(@current_project.identifier) %></br>
      <% end %>
    <% end %>
  <% end %>
</aside>

<% if user_signed_in? %>
  <% if @scorecard_assignment.present? %>
    <% if @existing_scorecard.present? %>
      <%= link_to 'Open Scorecard', edit_scorecard_path(@existing_scorecard), :id => 'open-scorecard' %>
      <%= javascript_tag  "window._scorecard_path = '#{edit_scorecard_path(@existing_scorecard)}';" %>
    <% else %>
      <%= link_to 'New Scorecard', new_scorecard_path(@scorecard_assignment, judgeable_type: 'Team', judgeable_id: @team.id), :id => 'open-scorecard' %>
      <%= javascript_tag "window._scorecard_path = #{new_scorecard_path(@scorecard_assignment, judgeable_type: 'Team', judgeable_id: @team.id)}" %>
    <% end %>
    <%= javascript_tag "window._scorecard_title = 'Scorecard for #{@current_project.team_name} - #{@current_project.project_name}'" %>
  <% end %>
<% else %>
  <p>Where you a voluneteer or participant in this year's competition? Sign in to vote in the People's Choice Awards.</p>
<% end %>

<h3>Project Info</h3>

<%= render 'team_project_info' %>

<h3>Team DataSets</h3>

<section class="markdown">

<% if (team_data_sets = @team.team_data_sets).present? %>

  <% team_data_sets.each do |team_data_set| %>
    <%= render 'team_data_set', locals: { data_set: team_data_set } %>
  <% end %>

<% else %>
  <div>This team does not currently have any datasets.</div>
<% end %>

</section>
<h3>Challenges</h3>
<section class="markdown">
  <% if passed_checkpoints.present? %>

    <% if @entries_to_display.present? %>

      <% @entries_to_display.each do |entry| %>
        <% challenge = entry.challenge %>
        <section class="markdown">
            <h4><%= challenge.name %></h4>
            <p><strong>Region</strong>: <%= @id_regions[challenge.region_id].name %></p>
            <%= link_to 'Challenge', challenge_path(challenge) %>
        </section>

      <% end %>

    <% else %>

      <p>There are no challenges to display for this team as yet.</p>

    <% end %>

  <% else %>

    <p>Check back here once the first checkpoint passes to see the challenges
      this team has entered.</p>

  <% end %>

</section>

<%= link_to 'Back to Projects', projects_path %>
  </main>
