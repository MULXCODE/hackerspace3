<main class="project_index">
  <h2>Team Projects for Competition <%= @competition.year %></h2>
  <% if @competition.started? || (user_signed_in? && current_user.region_privileges?) %>
    <%= form_tag projects_path, method: :get do %>
      <%= text_field_tag :term, params[:term] %>
      <%= submit_tag 'Search' %>
    <% end %>
    <%= link_to 'Clear Search', projects_path %></br>
    <%= link_to 'Download CSV', projects_path(format: 'csv') %></br>
    <% if user_signed_in? && @competition.not_finished?(LAST_TIME_ZONE) %>
      <% if @attending_events.present? %>
        <aside><%= link_to 'Create New Team Project', new_team_path %></aside>
      <% else %>
        <p><strong>Please register for a competition event to create a team.</strong></p>
        <p><%= link_to 'Competition Events', competition_events_path %></p>
      <% end %>
    <% end %>

    <table>
    	<thead>
    		<th>Project</th>
    		<th>Team</th>
    		<th>Location</th>
        <% if show_peoples_choice_stuff? %>
          <th>Project Scorecard</th>
        <% end %>
    	</thead>
    	<tbody>
        <% filter_projects(params[:term]).each do |project| %>
          <tr>
            <td><%= link_to "#{project.project_name}", project_path(project.identifier) %></td>
            <td><%= project.team_name %></td>
            <td><%= @id_teams_projects[project.team_id][:event].name %></td>
            <% if show_peoples_choice_stuff? %>
              <% if (display_score = @project_judging[project.team_id][:display_score_status]).is_a? Integer %>
            		<% score_value = ((display_score.to_f / @project_judging_total.to_f) * 100).to_i %>
                <%= render 'challenges/judging_cell', locals: { total: score_value } %>
            	<% else %>
            		<td><%= display_score %></td>
            	<% end %>
            <% end %>
          </tr>
        <% end %>
    	</tbody>
    </table>
  <% else %>
    <section class="later">
      <strong>Check back here at the commencement of the competition at <%= @competition.start_time.strftime("%I.%M %p %e %B %Y") %>.</stong>
    </section>
  <% end %>
</main>
