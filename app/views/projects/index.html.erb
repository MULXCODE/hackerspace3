<main class="project_index">

<h2>Team Projects for Competition <%= @competition.year %></h2>

<% if @competition.started? || (user_signed_in? && current_user.region_privileges?) %>

  <%= form_tag projects_path, method: :get do %>
    <%= text_field_tag :term, params[:term] %>
    <%= submit_tag 'Search' %>
  <% end %>
  <%= link_to 'Clear Search', projects_path %></br>
  <%= link_to 'Download CSV', projects_path(format: 'csv') %></br>
  <% if user_signed_in? && @competition.not_finished?(LAST_TIME_ZONE) %>
    <% if @attending_events.present? %>
      <aside><%= link_to 'Create New Team Project', new_team_path %></aside>
    <% else %>
      <p><strong>Please register for a competition event to create a team.</strong></p>
      <p><%= link_to 'Competition Events', competition_events_path %></p>
    <% end %>
  <% end %>

<table>
	<thead>
		<th>Project</th>
		<th>Team</th>
		<th>Location</th>
    <% if @judgeable_assignment.present? %>
      <th>Project Scorecard</th>
    <% end %>
	</thead>
	<tbody>
  <% filter_teams(@teams, params[:term]).each do |team| %>
  <tr>
    <% project = @id_teams_projects[team.id][:current_project] %>
    <% event = @id_teams_projects[team.id][:event] %>
    <td><%= link_to "#{project.project_name}", project_path(project.identifier) %></td>
    <td><%= project.team_name %></td>
    <td><%= event.name %></td>
    <% if @judgeable_assignment.present? %>
      <% if @project_judging[team.id][:display_score_status].is_a? Integer %>
    		<% score_value = ((@project_judging[team.id][:display_score_status].to_f / (@competition.score_total PROJECT).to_f) * 100).to_i %>
			<% rgb_g =  (255 * score_value) / 100 %>
			<% rgb_r =  (255 * (100 - score_value)) / 100 %>
			<td style="background-color: rgb(<%= rgb_r %>,<%= rgb_g %>,0); color: white; text-align: center; font-weight: 700; font-size: 1.25;"><%= score_value %>%</td>
    	<% else %>
    		<td><%= @project_judging[team.id][:display_score_status] %></td>
    	<% end %>
    <% end %>
  </tr>
  <% end %>
	</tbody>
</table>
<% else %>
<section class="later">
  <strong>Check back here at the commencement of the competition at <%= @competition.start_time.strftime("%I.%M %p %e %B %Y") %>.</stong>
</section>
<% end %>
